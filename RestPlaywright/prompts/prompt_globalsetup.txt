
        You are an expert in Playwright and API testing.

        Input:
        I will provide you with:
        1. An OpenAPI/Swagger spec (YAML or JSON).

        2.From it, detect the authentication method(s) in `securitySchemes` and global `security`.
        Task:
        1. Detect all authentication methods in `components.securitySchemes` and `security`.
        2. Don't Write the securitySchemes in the global_Setup.js
        3. Generate a `global-setup.js` file for Playwright that configures authentication globally based on the detected scheme(s):
          - If `apiKey` → read API key from `process.env`, set it in `extraHTTPHeaders`, save to `auth.json`.
          - If `http` basic → read username/password from `process.env`, save to `auth.json`.
          - If OAuth2 → simulate token retrieval or placeholder, save token to `auth.json`.


        Rules:
       - Code must be valid ES modules (ESM).
       -The first two lines of the file must be:
          import dotenv from 'dotenv';
          dotenv.config();
       - Do not print print the open Api spect.
       - Do not hardcode sensitive values — use `process.env` with placeholder names.
       - Include error handling if no credentials are set.
       - Do not add explanations or comments.
       - don't put the OpenAPI JSON directly in the content field
       - don't Write the securitySchemes in the global_Setup.js

    The code should be valid ES modules (ESM) and work directly with `@playwright/test`.


import dotenv from 'dotenv';
import fs from 'fs';
import on from os;
import path from 'path';
dotenv.config();

const STORAGE_STATE_PATH = path.join(process.cwd(), 'auth.json');

async function globalSetup() {{
  const authData = {{ extraHTTPHeaders: {{}} }};


  const API_KEY_VALUE = process.env.API_KEY_VALUE;
  if (API_KEY_VALUE) {{
    authData.extraHTTPHeaders['api_key'] = API_KEY_VALUE;
  }}

  const OAUTH_ACCESS_TOKEN = process.env.OAUTH_ACCESS_TOKEN;
  if (OAUTH_ACCESS_TOKEN) {{
    authData.extraHTTPHeaders['Authorization'] = `Bearer ${{OAUTH_ACCESS_TOKEN}}`;
  }}

  const BASIC_AUTH_USERNAME = process.env.BASIC_AUTH_USERNAME;
  const BASIC_AUTH_PASSWORD = process.env.BASIC_AUTH_PASSWORD;
  if (BASIC_AUTH_USERNAME && BASIC_AUTH_PASSWORD) {{
    const credentials = Buffer.from(`${{BASIC_AUTH_USERNAME}}:${{BASIC_AUTH_PASSWORD}}`).toString('base64');
    authData.extraHTTPHeaders['Authorization'] = `Basic ${{credentials}}`;
  }} else if (BASIC_AUTH_USERNAME || BASIC_AUTH_PASSWORD) {{
    throw new Error('Both BASIC_AUTH_USERNAME and BASIC_AUTH_PASSWORD must be set for HTTP Basic authentication.');
  }}

  if (Object.keys(authData.extraHTTPHeaders).length === 0) {{
    throw new Error('No authentication credentials found. Please set API_KEY_VALUE, OAUTH_ACCESS_TOKEN, or BASIC_AUTH_USERNAME/PASSWORD environment variables.');
  }}

  fs.writeFileSync(
    STORAGE_STATE_PATH,
    JSON.stringify(authData, null, 2)
  );

  //const envFilePath = "./allure-results/environment.properties";
const resultsDir = path.join(__dirname, "allure-results");
  const envFilePath = path.join(resultsDir, "environment.properties");

  // Ensure allure-results directory exists
  if (!fs.existsSync(resultsDir)) {{
    fs.mkdirSync(resultsDir, {{ recursive: true }});
  }}
  const envData = [
    `OS=${{os.type()}} ${{os.release()}}`,
    `Node=${{process.version}}`,
    `BaseURL=${{process.env.BASE_URL || "http://localhost:3000"}}`,
    `Browser=Playwright Default`,
    `Project=PetStore`,
    `Organization=Accion Labs`,
  ].join("\n");

  fs.writeFileSync(envFilePath, envData, "utf-8");
}}

export default globalSetup;


